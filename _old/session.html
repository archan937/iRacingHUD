<!DOCTYPE html>
<html>
  <head>
    <title>Session</title>
    <script src="./umd/react.development.js"></script>
    <script src="./umd/react-dom.development.js"></script>
    <script src="./umd/styled-components.min.js"></script>
    <script src="./umd/immer.min.js"></script>
    <script src="./umd/moment.js"></script>
    <script src="./umd/game-state.js"></script>
    <script src="./umd/babel.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script type="text/babel">
      function App() {
        const epoch = React.useRef(0);
        const [state, setState] = useImmerState();
        const [time, setTime] = React.useState();

        const updateTime = () => {
          setTime(
            moment
              .utc(new Date().getTime() - epoch.current * 1000)
              .format("HH:mm:ss")
          );
        };

        React.useEffect(() => {
          syncGameState(setState, (state) => {
            if (state.epoch) {
              if (!epoch.current) {
                setInterval(
                  updateTime,
                  Math.floor(Math.random() * (100 - 75 + 1) + 75)
                );
              }
              epoch.current = state.epoch;
            }
          });
        }, []);

        const Frame = styled.div`
          position: absolute;
          width: 100%;
          height: 100%;
          opacity: 0.65;
          background: black;
          border-radius: 10px;
          z-index: 1;
        `;

        const Flex = styled.div`
          padding: 30px;
          display: flex;
          position: relative;
          z-index: 1;
        `;

        const Label = styled.div`
          color: white;
          font-family: Microsoft YaHei UI;
          font-size: 18px;
          font-weight: 400;
        `;

        return (
          <>
            <Frame />
            <Flex>
              <div style={{ paddingRight: "12px" }}>
                <Label>Time:</Label>
                <Label>Laps:</Label>
                <Label>Drivers:</Label>
                <Label>SoF:</Label>
                <Label>Incidents:</Label>
              </div>
              <div>
                <Label>{time}</Label>
                <Label>
                  {state.lap} / {state.totalLaps}
                </Label>
                <Label>{state.drivers}</Label>
                <Label>{state.sof}</Label>
                <Label>{state.incidents}</Label>
              </div>
            </Flex>
          </>
        );
      }

      ReactDOM.render(<App />, document.getElementById("app"));
    </script>
  </body>
</html>
